<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Screen Draw (SVG Save/Load)</title>
    <link rel="stylesheet" href="styles.css">
    <style>
      body { margin: 0; overflow: hidden; background: #15202B; }
      #drawingCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
      #controls { position: absolute; top: 10px; left: 10px; z-index: 10; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 5px; color: white; }
      #strokeBar { position: absolute; top: 110px; left: 10px; z-index: 10; background: rgba(0, 0, 0, 0.7); padding: 10px; border-radius: 5px; color: white; display: none; }
      #controls button, #controls input, #strokeBar input, #strokeBar select { margin: 5px; }
      .colorButton { width: 30px; height: 30px; border: none; cursor: pointer; }
      #helpPanel { display: none; position: absolute; top: 50px; left: 10px; background: rgba(0, 0, 0, 0.8); color: white; padding: 15px; border-radius: 5px; max-width: 400px; z-index: 10; }
      #colorButtons { display: flex; flex-wrap: wrap; gap: 5px; }
    </style>
  </head>
  <body>
    <div id="controls">
      <button onclick="DrawingModule.clearCanvas()">Clear All</button>
      <button onclick="StateModule.saveCanvas()">Save SVG</button>
      <button onclick="document.getElementById('fileInput').click()">Load SVG</button>
      <input type="file" id="fileInput" accept=".svg, image/svg+xml" style="display: none;">
      <button onclick="toggleHelp()">Help</button>
      <label>Background Color: <input type="color" id="backgroundColorPicker" value="#15202B"></label>
      <label>Autosave Interval (s): <input type="number" id="autosaveInterval" min="1" max="60" value="10"></label>
    </div>
    <!-- Stroke Bar: Controls for editing stroke attributes, shown only when strokes are selected -->
    <div id="strokeBar">
      <label>Selected: 
        <select id="strokeSelect"></select>
      </label>
      <label>Color: <input type="color" id="colorPicker" value="#FFFFFF"></label>
      <div id="colorButtons">
        <button class="colorButton" style="background: #FFFFFF;" onclick="SettingsModule.selectColor('#FFFFFF')"></button>
        <button class="colorButton" style="background: #FF0000;" onclick="SettingsModule.selectColor('#FF0000')"></button>
        <button class="colorButton" style="background: #00FF00;" onclick="SettingsModule.selectColor('#00FF00')"></button>
        <button class="colorButton" style="background: #0000FF;" onclick="SettingsModule.selectColor('#0000FF')"></button>
        <button class="colorButton" style="background: #FFFF00;" onclick="SettingsModule.selectColor('#FFFF00')"></button>
        <button class="colorButton" style="background: #800080;" onclick="SettingsModule.selectColor('#800080')"></button>
        <button class="colorButton" style="background: #FFA500;" onclick="SettingsModule.selectColor('#FFA500')"></button>
        <button class="colorButton" style="background: #00FFFF;" onclick="SettingsModule.selectColor('#00FFFF')"></button>
        <button class="colorButton" style="background: #FF00FF;" onclick="SettingsModule.selectColor('#FF00FF')"></button>
        <button class="colorButton" style="background: #000000;" onclick="SettingsModule.selectColor('#000000')"></button>
      </div>
      <label>Brush Size: <input type="range" id="brushSize" min="1" max="50" value="5"></label>
      <label>Fill: 
        <select id="fillColorPicker">
          <option value="none">None</option>
          <option value="#000000">Black</option>
          <option value="#FFFFFF">White</option>
          <option value="#FF0000">Red</option>
          <option value="#00FF00">Green</option>
          <option value="#0000FF">Blue</option>
        </select>
      </label>
      <label>Linecap: 
        <select id="strokeLinecap">
          <option value="round">Round</option>
          <option value="butt">Butt</option>
          <option value="square">Square</option>
        </select>
      </label>
      <label>Linejoin: 
        <select id="strokeLinejoin">
          <option value="round">Round</option>
          <option value="miter">Miter</option>
          <option value="bevel">Bevel</option>
        </select>
      </label>
      <label>Dasharray: 
        <select id="strokeDasharray">
          <option value="">None</option>
          <option value="5,5">Dashed</option>
          <option value="10,10">Long Dash</option>
          <option value="1,5">Dotted</option>
          <option value="2,2">Dense Dotted</option>
          <option value="10,5,2,5">Dash-Dot</option>
          <option value="15,10,5,10">Sparse Dash-Dot</option>
        </select>
      </label>
      <label>Opacity: <input type="range" id="opacity" min="0" max="1" step="0.1" value="1"></label>
      <label>Shadow: 
        <select id="shadowFilter">
          <option value="">None</option>
          <option value="url(#dynamicShadow)">Shadow</option>
        </select>
      </label>
      <label>Shadow Color: <input type="color" id="shadowColorPicker" value="#000000"></label>
      <label>Link: <input type="text" id="strokeLink" value="" placeholder="https://example.com"></label>
    </div>
    <div id="helpPanel">
      <h3>Controls</h3>
      <ul>
        <li><b>Draw</b>: Left-click or use stylus to draw strokes.</li>
        <li><b>Erase</b>: Hold right-click to erase strokes.</li>
        <li><b>Pan</b>: Hold 'M' and drag with mouse/pen.</li>
        <li><b>Zoom</b>: Hold 'N' and drag up/down with mouse/pen.</li>
        <li><b>Undo</b>: Ctrl+Z (undoes last stroke).</li>
        <li><b>Select & Transform</b>: Hold Space to enter selection mode. Drag to draw a rectangle selecting multiple strokes. Drag with mouse to move selected strokes, or drag bottom-right handle to resize. Release Space to exit. Selected strokes remain active.</li>
        <li><b>Deselect</b>: Press Esc to deselect all strokes or cancel selection rectangle.</li>
        <li><b>Stroke Bar</b>: Appears when strokes are selected. Edit attributes (color, brush size, fill, linecap, linejoin, dasharray, opacity, shadow, shadow color, link) for the selected stroke. Use dropdown or Tab key to cycle through selected strokes. Set fill to "None" to remove fill color.</li>
        <li><b>Cycle Strokes</b>: Press Tab to cycle through selected strokes in the stroke bar.</li>
        <li><b>Link</b>: Edit the hyperlink for the current stroke in the stroke bar</li>
        <li><b>Colors</b>: Use keybinds 1-9 to select stroke colors for drawing or editing selected strokes.</li>
        <li><b>Save SVG</b>: Click "Save SVG" to download a standard .svg file, including shadows.</li>
        <li><b>Load SVG</b>: Click "Load SVG" to load a standard .svg file (resets view).</li>
        <li><b>Autosave</b>: State is saved to local storage every N seconds (configurable in controls, default 10s).</li>
      </ul>
      <button onclick="toggleHelp()">Close</button>
    </div>
    <canvas id="drawingCanvas"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script type="module" src="dist/main.js"></script>
  </body>
</html>
